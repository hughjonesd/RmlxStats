<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Benchmarking MLX-backed Linear and Generalized Linear Models â€¢ RmlxStats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Benchmarking MLX-backed Linear and Generalized Linear Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RmlxStats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/benchmark-lm-mlxs.html">Benchmarking MLX-backed Linear and Generalized Linear Models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Benchmarking MLX-backed Linear and Generalized Linear Models</h1>
            
      

      <div class="d-none name"><code>benchmark-lm-mlxs.Rmd</code></div>
    </div>

    
    
<p>The <code><a href="../reference/mlxs_lm.html">mlxs_lm()</a></code> and <code><a href="../reference/mlxs_glm.html">mlxs_glm()</a></code> functions
mirror <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm()</a></code> and <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> but
execute their linear algebra with the MLX backend. This vignette
benchmarks these implementations against standard R functions and
specialized fast fitting packages (fixest, RcppEigen, speedglm, fastglm)
using the sizeable <code><a href="https://rdrr.io/pkg/nycflights13/man/flights.html" class="external-link">nycflights13::flights</a></code> dataset,
demonstrating the performance gains available when Metal acceleration is
active.</p>
<div class="section level2">
<h2 id="data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>We retain a handful of numeric predictors from the flights data and
drop rows with missing values in the variables of interest.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">nycflights13</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/nycflights13/man/flights.html" class="external-link">flights</a></span><span class="op">)</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"arr_delay"</span>, <span class="st">"dep_delay"</span>, <span class="st">"air_time"</span>, <span class="st">"distance"</span><span class="op">)</span></span>
<span><span class="va">complete_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">flights</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">bench_data</span> <span class="op">&lt;-</span> <span class="va">flights</span><span class="op">[</span><span class="va">complete_rows</span>, <span class="va">vars</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bench_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 327346</span></span></code></pre></div>
<p>The resulting dataset contains hundreds of thousands of observations,
large enough to expose performance differences in the solvers.</p>
</div>
<div class="section level2">
<h2 id="benchmark-setup">Benchmark Setup<a class="anchor" aria-label="anchor" href="#benchmark-setup"></a>
</h2>
<p>We benchmark several linear model solvers that accept formula
interfaces. The <code>bench</code> package automates warm-up and
repetition.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_formula</span> <span class="op">&lt;-</span> <span class="va">arr_delay</span> <span class="op">~</span> <span class="va">dep_delay</span> <span class="op">+</span> <span class="va">air_time</span> <span class="op">+</span> <span class="va">distance</span></span>
<span></span>
<span><span class="va">bench_mark</span> <span class="op">&lt;-</span> <span class="fu">mark</span><span class="op">(</span></span>
<span>  lm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span>,</span>
<span>  mlxs_lm <span class="op">=</span> <span class="fu"><a href="../reference/mlxs_lm.html">mlxs_lm</a></span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span>,</span>
<span>  feols <span class="op">=</span> <span class="fu">feols</span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span>,</span>
<span>  fastLm <span class="op">=</span> <span class="fu">RcppEigen</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppEigen/man/fastLm.html" class="external-link">fastLm</a></span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span>,</span>
<span>  speedlm <span class="op">=</span> <span class="fu">speedglm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/speedglm/man/speedlm.html" class="external-link">speedlm</a></span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is</span></span>
<span><span class="co">#&gt; disabled.</span></span>
<span></span>
<span><span class="co"># Summarize median timings, memory allocation, and relative speed.</span></span>
<span><span class="va">bench_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">bench_mark</span><span class="op">$</span><span class="va">expression</span><span class="op">)</span>,</span>
<span>  median_sec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bench_mark</span><span class="op">$</span><span class="va">median</span>, units <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span>,</span>
<span>  mem_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bench_mark</span><span class="op">$</span><span class="va">mem_alloc</span>, units <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span>,</span>
<span>  itr_per_sec <span class="op">=</span> <span class="va">bench_mark</span><span class="op">$</span><span class="va">`itr/sec`</span></span>
<span><span class="op">)</span></span>
<span><span class="va">bench_summary</span><span class="op">$</span><span class="va">relative</span> <span class="op">&lt;-</span> <span class="va">bench_summary</span><span class="op">$</span><span class="va">median_sec</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">bench_summary</span><span class="op">$</span><span class="va">median_sec</span><span class="op">)</span></span>
<span><span class="va">bench_summary</span></span>
<span><span class="co">#&gt;    method median_sec    mem_mb itr_per_sec relative</span></span>
<span><span class="co">#&gt; 1      lm 0.09174861  91103808    8.479591 2.222611</span></span>
<span><span class="co">#&gt; 2 mlxs_lm 0.05283358  67377200   12.593409 1.279894</span></span>
<span><span class="co">#&gt; 3   feols 0.04127966  32390888   22.688937 1.000000</span></span>
<span><span class="co">#&gt; 4  fastLm 0.22772335 119984248    4.087392 5.516599</span></span>
<span><span class="co">#&gt; 5 speedlm 0.04163283  75406984   10.481493 1.008556</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">bench_mark</span>, type <span class="op">=</span> <span class="st">"boxplot"</span><span class="op">)</span></span></code></pre></div>
<p><img src="benchmark-lm-mlxs_files/figure-html/timings-1.png" class="r-plt" width="700"></p>
<p>The benchmark table reports the median execution time (seconds),
memory allocation (megabytes), iteration rate, and relative speed for
each method across five iterations. The <code>relative</code> column
expresses how many times slower each method is compared to the fastest
option (values close to 1 indicate the winner).</p>
</div>
<div class="section level2">
<h2 id="agreement-on-flights-benchmark">Agreement on Flights Benchmark<a class="anchor" aria-label="anchor" href="#agreement-on-flights-benchmark"></a>
</h2>
<p>Confirm that each solver matches the reference solution within
floating point tolerance.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span></span>
<span><span class="va">mlxs_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlxs_lm.html">mlxs_lm</a></span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span></span>
<span><span class="va">feols_fit</span> <span class="op">&lt;-</span> <span class="fu">feols</span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span></span>
<span><span class="va">fastlm_fit</span> <span class="op">&lt;-</span> <span class="fu">RcppEigen</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppEigen/man/fastLm.html" class="external-link">fastLm</a></span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span></span>
<span><span class="va">speedlm_fit</span> <span class="op">&lt;-</span> <span class="fu">speedglm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/speedglm/man/speedlm.html" class="external-link">speedlm</a></span><span class="op">(</span><span class="va">lm_formula</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coef_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">mlxs_fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fitted_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">mlxs_fit</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">feols_coef_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">feols_fit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">feols_fitted_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">feols_fit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fastlm_coef_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">fastlm_fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fastlm_fitted_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">fastlm_fit</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">speedlm_coef_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">speedlm_fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">speedlm_fitted_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">speedlm_fit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in predict.speedlm(speedlm_fit): fitted values were not returned from the speedglm object: </span></span>
<span><span class="co">#&gt;               use the original data by setting argument 'newdata' or refit </span></span>
<span><span class="co">#&gt;               the model by specifying fitted=TRUE.</span></span>
<span><span class="co">#&gt; Warning in max(abs(fitted(lm_fit) - as.vector(predict(speedlm_fit)))): no</span></span>
<span><span class="co">#&gt; non-missing arguments to max; returning -Inf</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  max_coefficient_difference <span class="op">=</span> <span class="va">coef_delta</span>,</span>
<span>  max_fitted_difference <span class="op">=</span> <span class="va">fitted_delta</span>,</span>
<span>  feols_max_coefficient_difference <span class="op">=</span> <span class="va">feols_coef_delta</span>,</span>
<span>  feols_max_fitted_difference <span class="op">=</span> <span class="va">feols_fitted_delta</span>,</span>
<span>  fastlm_max_coefficient_difference <span class="op">=</span> <span class="va">fastlm_coef_delta</span>,</span>
<span>  fastlm_max_fitted_difference <span class="op">=</span> <span class="va">fastlm_fitted_delta</span>,</span>
<span>  speedlm_max_coefficient_difference <span class="op">=</span> <span class="va">speedlm_coef_delta</span>,</span>
<span>  speedlm_max_fitted_difference <span class="op">=</span> <span class="va">speedlm_fitted_delta</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $max_coefficient_difference.ptr</span></span>
<span><span class="co">#&gt; &lt;pointer: 0x600002b08cb0&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_coefficient_difference.dim</span></span>
<span><span class="co">#&gt; integer(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_coefficient_difference.dtype</span></span>
<span><span class="co">#&gt; [1] "float32"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_coefficient_difference.device</span></span>
<span><span class="co">#&gt; [1] "gpu"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_fitted_difference.ptr</span></span>
<span><span class="co">#&gt; &lt;pointer: 0x600002b08f60&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_fitted_difference.dim</span></span>
<span><span class="co">#&gt; integer(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_fitted_difference.dtype</span></span>
<span><span class="co">#&gt; [1] "float32"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_fitted_difference.device</span></span>
<span><span class="co">#&gt; [1] "gpu"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $feols_max_coefficient_difference</span></span>
<span><span class="co">#&gt; [1] 8.677503e-12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $feols_max_fitted_difference</span></span>
<span><span class="co">#&gt; [1] 5.844186e-09</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fastlm_max_coefficient_difference</span></span>
<span><span class="co">#&gt; [1] 8.236967e-12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fastlm_max_fitted_difference</span></span>
<span><span class="co">#&gt; [1] 5.830291e-09</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $speedlm_max_coefficient_difference</span></span>
<span><span class="co">#&gt; [1] 8.380852e-12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $speedlm_max_fitted_difference</span></span>
<span><span class="co">#&gt; [1] -Inf</span></span></code></pre></div>
<p>Differences remain on the order of numerical precision, confirming
that <code><a href="../reference/mlxs_lm.html">mlxs_lm()</a></code> and the other high-performance solvers
reproduce the reference solution while offering faster runtimes.</p>
</div>
<div class="section level2">
<h2 id="high-dimensional-benchmark">High-Dimensional Benchmark<a class="anchor" aria-label="anchor" href="#high-dimensional-benchmark"></a>
</h2>
<p>To stress-test performance when both sample size and feature count
are large, we simulate a design matrix with many rows and columns.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20251031</span><span class="op">)</span></span>
<span><span class="va">n_hd</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">p_hd</span> <span class="op">&lt;-</span> <span class="fl">400</span></span>
<span><span class="va">x_hd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_hd</span> <span class="op">*</span> <span class="va">p_hd</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n_hd</span>, ncol <span class="op">=</span> <span class="va">p_hd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x_hd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p_hd</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">beta_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">p_hd</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">y_hd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">x_hd</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_true</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_hd</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hd_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y_hd</span>, <span class="va">x_hd</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>expressions <span class="op">=</span> <span class="fl">15000</span><span class="op">)</span> <span class="co"># to avoid errors due to nested evaluation</span></span>
<span><span class="va">hd_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">DF2formula</a></span><span class="op">(</span><span class="va">hd_data</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hd_mark</span> <span class="op">&lt;-</span> <span class="fu">mark</span><span class="op">(</span></span>
<span>  lm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">hd_formula</span>, data <span class="op">=</span> <span class="va">hd_data</span><span class="op">)</span>,</span>
<span>  mlxs_lm <span class="op">=</span> <span class="fu"><a href="../reference/mlxs_lm.html">mlxs_lm</a></span><span class="op">(</span><span class="va">hd_formula</span>, data <span class="op">=</span> <span class="va">hd_data</span><span class="op">)</span>,</span>
<span>  feols <span class="op">=</span> <span class="fu">feols</span><span class="op">(</span><span class="va">hd_formula</span>, data <span class="op">=</span> <span class="va">hd_data</span><span class="op">)</span>,</span>
<span>  fastLm <span class="op">=</span> <span class="fu">RcppEigen</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppEigen/man/fastLm.html" class="external-link">fastLm</a></span><span class="op">(</span><span class="va">hd_formula</span>, data <span class="op">=</span> <span class="va">hd_data</span><span class="op">)</span>,</span>
<span>  speedlm <span class="op">=</span> <span class="fu">speedglm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/speedglm/man/speedlm.html" class="external-link">speedlm</a></span><span class="op">(</span><span class="va">hd_formula</span>, data <span class="op">=</span> <span class="va">hd_data</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is</span></span>
<span><span class="co">#&gt; disabled.</span></span>
<span></span>
<span><span class="va">hd_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">hd_mark</span><span class="op">$</span><span class="va">expression</span><span class="op">)</span>,</span>
<span>  median_sec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">hd_mark</span><span class="op">$</span><span class="va">median</span>, units <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span>,</span>
<span>  mem_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">hd_mark</span><span class="op">$</span><span class="va">mem_alloc</span>, units <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span>,</span>
<span>  itr_per_sec <span class="op">=</span> <span class="va">hd_mark</span><span class="op">$</span><span class="va">`itr/sec`</span></span>
<span><span class="op">)</span></span>
<span><span class="va">hd_summary</span><span class="op">$</span><span class="va">relative</span> <span class="op">&lt;-</span> <span class="va">hd_summary</span><span class="op">$</span><span class="va">median_sec</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">hd_summary</span><span class="op">$</span><span class="va">median_sec</span><span class="op">)</span></span>
<span><span class="va">hd_summary</span></span>
<span><span class="co">#&gt;    method median_sec    mem_mb itr_per_sec  relative</span></span>
<span><span class="co">#&gt; 1      lm  1.0515591 198187456   0.9752880  6.843389</span></span>
<span><span class="co">#&gt; 2 mlxs_lm  0.1536606 165631808   4.2926579  1.000000</span></span>
<span><span class="co">#&gt; 3   feols  1.9132746  81721048   0.5160914 12.451304</span></span>
<span><span class="co">#&gt; 4  fastLm  1.2023910 278407080   0.8370399  7.824980</span></span>
<span><span class="co">#&gt; 5 speedlm  0.3026046 188431080   3.3416597  1.969305</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">hd_mark</span>, type <span class="op">=</span> <span class="st">"beeswarm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="benchmark-lm-mlxs_files/figure-html/highp-benchmark-1.png" class="r-plt" width="700"></p>
</div>
<div class="section level2">
<h2 id="agreement-on-the-simulated-problem">Agreement on the Simulated Problem<a class="anchor" aria-label="anchor" href="#agreement-on-the-simulated-problem"></a>
</h2>
<p>Even in the high-dimensional setting, the MLX-backed fit lines up
with the reference linear model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_hd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">hd_formula</span>, data <span class="op">=</span> <span class="va">hd_data</span><span class="op">)</span></span>
<span><span class="va">mlxs_hd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlxs_lm.html">mlxs_lm</a></span><span class="op">(</span><span class="va">hd_formula</span>, data <span class="op">=</span> <span class="va">hd_data</span><span class="op">)</span></span>
<span><span class="va">speedlm_hd</span> <span class="op">&lt;-</span> <span class="fu">speedglm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/speedglm/man/speedlm.html" class="external-link">speedlm</a></span><span class="op">(</span><span class="va">hd_formula</span>, data <span class="op">=</span> <span class="va">hd_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_hd</span><span class="op">)</span> <span class="op">-</span> <span class="va">mlxs_hd</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm_hd</span><span class="op">)</span> <span class="op">-</span> <span class="va">speedlm_hd</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $ptr</span></span>
<span><span class="co">#&gt; &lt;pointer: 0x600002b08f20&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dim</span></span>
<span><span class="co">#&gt; integer(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dtype</span></span>
<span><span class="co">#&gt; [1] "float32"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $device</span></span>
<span><span class="co">#&gt; [1] "gpu"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 3.663736e-15</span></span></code></pre></div>
<p>The largest coefficient difference stays at floating-point noise
levels, confirming that the accelerated solver preserves numerical
accuracy while scaling gracefully with both observations and
predictors.</p>
</div>
<div class="section level2">
<h2 id="glm-benchmark-logistic-regression">GLM Benchmark: Logistic Regression<a class="anchor" aria-label="anchor" href="#glm-benchmark-logistic-regression"></a>
</h2>
<p>The <code><a href="../reference/mlxs_glm.html">mlxs_glm()</a></code> function extends the MLX backend to
generalized linear models. We benchmark it against
<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> and <code><a href="https://rdrr.io/pkg/speedglm/man/speedglm.html" class="external-link">speedglm::speedglm()</a></code> using a
binomial family on the flights data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create binary outcome: whether arrival delay exceeds 15 minutes</span></span>
<span><span class="va">bench_data</span><span class="op">$</span><span class="va">late</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">bench_data</span><span class="op">$</span><span class="va">arr_delay</span> <span class="op">&gt;</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">glm_formula</span> <span class="op">&lt;-</span> <span class="va">late</span> <span class="op">~</span> <span class="va">dep_delay</span> <span class="op">+</span> <span class="va">air_time</span> <span class="op">+</span> <span class="va">distance</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_mark</span> <span class="op">&lt;-</span> <span class="fu">mark</span><span class="op">(</span></span>
<span>  glm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">glm_formula</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span>,</span>
<span>  mlxs_glm <span class="op">=</span> <span class="fu"><a href="../reference/mlxs_glm.html">mlxs_glm</a></span><span class="op">(</span><span class="va">glm_formula</span>, family <span class="op">=</span> <span class="fu"><a href="../reference/mlxs_binomial.html">mlxs_binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span>,</span>
<span>  speedglm <span class="op">=</span> <span class="fu">speedglm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/speedglm/man/speedglm.html" class="external-link">speedglm</a></span><span class="op">(</span><span class="va">glm_formula</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is</span></span>
<span><span class="co">#&gt; disabled.</span></span>
<span></span>
<span><span class="va">glm_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">glm_mark</span><span class="op">$</span><span class="va">expression</span><span class="op">)</span>,</span>
<span>  median_sec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">glm_mark</span><span class="op">$</span><span class="va">median</span>, units <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span>,</span>
<span>  mem_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">glm_mark</span><span class="op">$</span><span class="va">mem_alloc</span>, units <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span>,</span>
<span>  itr_per_sec <span class="op">=</span> <span class="va">glm_mark</span><span class="op">$</span><span class="va">`itr/sec`</span></span>
<span><span class="op">)</span></span>
<span><span class="va">glm_summary</span><span class="op">$</span><span class="va">relative</span> <span class="op">&lt;-</span> <span class="va">glm_summary</span><span class="op">$</span><span class="va">median_sec</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">glm_summary</span><span class="op">$</span><span class="va">median_sec</span><span class="op">)</span></span>
<span><span class="va">glm_summary</span></span>
<span><span class="co">#&gt;     method median_sec     mem_mb itr_per_sec relative</span></span>
<span><span class="co">#&gt; 1      glm  0.5718007 1027386600    1.623614 1.593433</span></span>
<span><span class="co">#&gt; 2 mlxs_glm  0.5378026  275699296    1.702651 1.498691</span></span>
<span><span class="co">#&gt; 3 speedglm  0.3588482  528434864    2.298443 1.000000</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">glm_mark</span>, type <span class="op">=</span> <span class="st">"boxplot"</span><span class="op">)</span></span></code></pre></div>
<p><img src="benchmark-lm-mlxs_files/figure-html/glm-timings-1.png" class="r-plt" width="700"></p>
</div>
<div class="section level2">
<h2 id="agreement-on-glm-benchmark">Agreement on GLM Benchmark<a class="anchor" aria-label="anchor" href="#agreement-on-glm-benchmark"></a>
</h2>
<p>Check that the MLX-backed GLM matches the reference
implementation:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">glm_formula</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span><span class="va">mlxs_glm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlxs_glm.html">mlxs_glm</a></span><span class="op">(</span><span class="va">glm_formula</span>, family <span class="op">=</span> <span class="fu"><a href="../reference/mlxs_binomial.html">mlxs_binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span></span>
<span><span class="va">speedglm_fit</span> <span class="op">&lt;-</span> <span class="fu">speedglm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/speedglm/man/speedglm.html" class="external-link">speedglm</a></span><span class="op">(</span><span class="va">glm_formula</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">bench_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_coef_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">glm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">mlxs_glm_fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">glm_fitted_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">glm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">mlxs_glm_fit</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">speedglm_coef_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">glm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">speedglm_fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">speedglm_fitted_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">glm_fit</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">speedglm_fit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in predict.speedglm(speedglm_fit): fitted values were not returned from the speedglm object: </span></span>
<span><span class="co">#&gt;             use the original data by setting argument 'newdata' or refit </span></span>
<span><span class="co">#&gt;             the model by specifying fitted=TRUE.</span></span>
<span><span class="co">#&gt; Warning in max(abs(fitted(glm_fit) - as.vector(predict(speedglm_fit)))): no</span></span>
<span><span class="co">#&gt; non-missing arguments to max; returning -Inf</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  mlxs_max_coefficient_difference <span class="op">=</span> <span class="va">glm_coef_delta</span>,</span>
<span>  mlxs_max_fitted_difference <span class="op">=</span> <span class="va">glm_fitted_delta</span>,</span>
<span>  speedglm_max_coefficient_difference <span class="op">=</span> <span class="va">speedglm_coef_delta</span>,</span>
<span>  speedglm_max_fitted_difference <span class="op">=</span> <span class="va">speedglm_fitted_delta</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $mlxs_max_coefficient_difference.ptr</span></span>
<span><span class="co">#&gt; &lt;pointer: 0x600002b018a0&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mlxs_max_coefficient_difference.dim</span></span>
<span><span class="co">#&gt; integer(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mlxs_max_coefficient_difference.dtype</span></span>
<span><span class="co">#&gt; [1] "float32"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mlxs_max_coefficient_difference.device</span></span>
<span><span class="co">#&gt; [1] "gpu"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mlxs_max_fitted_difference.ptr</span></span>
<span><span class="co">#&gt; &lt;pointer: 0x600002b02390&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mlxs_max_fitted_difference.dim</span></span>
<span><span class="co">#&gt; integer(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mlxs_max_fitted_difference.dtype</span></span>
<span><span class="co">#&gt; [1] "float32"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mlxs_max_fitted_difference.device</span></span>
<span><span class="co">#&gt; [1] "gpu"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $speedglm_max_coefficient_difference</span></span>
<span><span class="co">#&gt; [1] 2.381206e-12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $speedglm_max_fitted_difference</span></span>
<span><span class="co">#&gt; [1] -Inf</span></span></code></pre></div>
<p>All implementations agree within numerical tolerance, confirming that
<code><a href="../reference/mlxs_glm.html">mlxs_glm()</a></code> produces accurate results for generalized linear
models.</p>
</div>
<div class="section level2">
<h2 id="high-dimensional-glm-benchmark">High-dimensional GLM Benchmark<a class="anchor" aria-label="anchor" href="#high-dimensional-glm-benchmark"></a>
</h2>
<p>Large logistic regressions in practice often include hundreds of
engineered features. To stress both runtime and numerical stability we
fabricate a dense dataset with 5,000 observations and 200 predictors,
then compare execution speed across solvers.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20251103</span><span class="op">)</span></span>
<span><span class="va">n_glm</span> <span class="op">&lt;-</span> <span class="fl">5000</span></span>
<span><span class="va">p_glm</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">x_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_glm</span> <span class="op">*</span> <span class="va">p_glm</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n_glm</span>, ncol <span class="op">=</span> <span class="va">p_glm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x_glm</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">p_glm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">beta_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">p_glm</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">linpred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">x_glm</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_glm</span><span class="op">)</span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">linpred</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_glm</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">prob</span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_hd_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y_glm</span>, <span class="va">x_glm</span><span class="op">)</span></span>
<span><span class="va">glm_hd_formula</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span> <span class="va">.</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_hd_mark</span> <span class="op">&lt;-</span> <span class="fu">mark</span><span class="op">(</span></span>
<span>  glm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">glm_hd_formula</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">glm_hd_data</span>,</span>
<span>            control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mlxs_glm <span class="op">=</span> <span class="fu"><a href="../reference/mlxs_glm.html">mlxs_glm</a></span><span class="op">(</span><span class="va">glm_hd_formula</span>, family <span class="op">=</span> <span class="fu"><a href="../reference/mlxs_binomial.html">mlxs_binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">glm_hd_data</span>,</span>
<span>                      control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">50</span>, epsilon <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  speedglm <span class="op">=</span> <span class="fu">speedglm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/speedglm/man/speedglm.html" class="external-link">speedglm</a></span><span class="op">(</span><span class="va">glm_hd_formula</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">glm_hd_data</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">glm_hd_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">glm_hd_mark</span><span class="op">$</span><span class="va">expression</span><span class="op">)</span>,</span>
<span>  median_sec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">glm_hd_mark</span><span class="op">$</span><span class="va">median</span>, units <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span>,</span>
<span>  mem_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">glm_hd_mark</span><span class="op">$</span><span class="va">mem_alloc</span>, units <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span>,</span>
<span>  itr_per_sec <span class="op">=</span> <span class="va">glm_hd_mark</span><span class="op">$</span><span class="va">`itr/sec`</span></span>
<span><span class="op">)</span></span>
<span><span class="va">glm_hd_summary</span><span class="op">$</span><span class="va">relative</span> <span class="op">&lt;-</span> <span class="va">glm_hd_summary</span><span class="op">$</span><span class="va">median_sec</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">glm_hd_summary</span><span class="op">$</span><span class="va">median_sec</span><span class="op">)</span></span>
<span><span class="va">glm_hd_summary</span></span>
<span><span class="co">#&gt;     method median_sec    mem_mb itr_per_sec relative</span></span>
<span><span class="co">#&gt; 1      glm 0.43116801 167405736    2.319282 5.419412</span></span>
<span><span class="co">#&gt; 2 mlxs_glm 0.27273179  44221640    3.666606 3.428005</span></span>
<span><span class="co">#&gt; 3 speedglm 0.07955993 120938016   12.569142 1.000000</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">glm_hd_mark</span>, type <span class="op">=</span> <span class="st">"beeswarm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="benchmark-lm-mlxs_files/figure-html/glm-highd-benchmark-1.png" class="r-plt" width="700"></p>
</div>
<div class="section level2">
<h2 id="convergence-on-the-high-dimensional-problem">Convergence on the High-dimensional Problem<a class="anchor" aria-label="anchor" href="#convergence-on-the-high-dimensional-problem"></a>
</h2>
<p>After benchmarking we run each solver once more to inspect
convergence behaviour and solution agreement.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_hd_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">glm_hd_formula</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">glm_hd_data</span>,</span>
<span>                  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mlxs_hd_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlxs_glm.html">mlxs_glm</a></span><span class="op">(</span><span class="va">glm_hd_formula</span>, family <span class="op">=</span> <span class="fu"><a href="../reference/mlxs_binomial.html">mlxs_binomial</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">glm_hd_data</span>,</span>
<span>                        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">50</span>, epsilon <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  observations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">glm_hd_data</span><span class="op">)</span>,</span>
<span>  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">glm_hd_data</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  mlxs_converged <span class="op">=</span> <span class="va">mlxs_hd_fit</span><span class="op">$</span><span class="va">converged</span>,</span>
<span>  mlxs_iterations <span class="op">=</span> <span class="va">mlxs_hd_fit</span><span class="op">$</span><span class="va">iter</span>,</span>
<span>  max_coefficient_difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">glm_hd_fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">mlxs_hd_fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  max_fitted_difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">glm_hd_fit</span><span class="op">)</span> <span class="op">-</span> <span class="va">mlxs_hd_fit</span><span class="op">$</span><span class="va">fitted.values</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $observations</span></span>
<span><span class="co">#&gt; [1] 5000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $predictors</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mlxs_converged</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mlxs_iterations</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_coefficient_difference.ptr</span></span>
<span><span class="co">#&gt; &lt;pointer: 0x600002b15860&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_coefficient_difference.dim</span></span>
<span><span class="co">#&gt; integer(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_coefficient_difference.dtype</span></span>
<span><span class="co">#&gt; [1] "float32"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_coefficient_difference.device</span></span>
<span><span class="co">#&gt; [1] "gpu"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_fitted_difference.ptr</span></span>
<span><span class="co">#&gt; &lt;pointer: 0x600002b14b50&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_fitted_difference.dim</span></span>
<span><span class="co">#&gt; integer(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_fitted_difference.dtype</span></span>
<span><span class="co">#&gt; [1] "float32"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $max_fitted_difference.device</span></span>
<span><span class="co">#&gt; [1] "gpu"</span></span></code></pre></div>
<p>The MLX-backed fit converges in roughly the same number of iterations
as the reference and matches both coefficients and fitted values to
within floating point tolerance, while the timing table above highlights
the runtime benefits at this scale.</p>
</div>
<div class="section level2">
<h2 id="other-fast-linear-modeling-options">Other Fast Linear Modeling Options<a class="anchor" aria-label="anchor" href="#other-fast-linear-modeling-options"></a>
</h2>
<p>Beyond the methods benchmarked here, practitioners often turn to
<code><a href="https://rdrr.io/pkg/biglm/man/biglm.html" class="external-link">biglm::biglm()</a></code> for streamed data that do not fit in memory
or <code>glmnet</code> for elastic-net regularisation. Packages such as
<code>MatrixModels</code> and <code>SparseM</code> also provide
optimized pathways for sparse design matrices.</p>
</div>
<div class="section level2">
<h2 id="elastic-net-on-flights-data">Elastic Net on Flights Data<a class="anchor" aria-label="anchor" href="#elastic-net-on-flights-data"></a>
</h2>
<p>Finally we try the MLX-backed elastic-net solver on flights,
expanding the feature set with interaction terms to create a challenging
regression. The benchmark compares <code><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet::glmnet()</a></code> with
the new [mlxs_glmnet()] helper.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20251103</span><span class="op">)</span></span>
<span><span class="va">enet_rows</span> <span class="op">&lt;-</span> <span class="fl">50000</span></span>
<span><span class="va">enet_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bench_data</span><span class="op">)</span>, <span class="va">enet_rows</span><span class="op">)</span></span>
<span><span class="va">enet_base</span> <span class="op">&lt;-</span> <span class="va">bench_data</span><span class="op">[</span><span class="va">enet_idx</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">enet_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">dep_delay</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">air_time</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">distance</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">dep_delay</span>, <span class="fl">2</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">air_time</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">dep_delay</span>, <span class="fl">2</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">distance</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">air_time</span>, <span class="fl">2</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">distance</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">enet_base</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_enet</span> <span class="op">&lt;-</span> <span class="va">enet_design</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="va">y_enet</span> <span class="op">&lt;-</span> <span class="va">enet_base</span><span class="op">$</span><span class="va">arr_delay</span> <span class="op">&gt;</span> <span class="fl">15</span></span>
<span><span class="va">lambda_enet</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">enet_mark</span> <span class="op">&lt;-</span> <span class="fu">mark</span><span class="op">(</span></span>
<span>  glmnet <span class="op">=</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></span><span class="op">(</span><span class="va">x_enet</span>, <span class="va">y_enet</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                          lambda <span class="op">=</span> <span class="va">lambda_enet</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          thresh <span class="op">=</span> <span class="fl">1e-6</span>, maxit <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  mlxs_glmnet <span class="op">=</span> <span class="fu"><a href="../reference/mlxs_glmnet.html">mlxs_glmnet</a></span><span class="op">(</span><span class="va">x_enet</span>, <span class="va">y_enet</span>, family <span class="op">=</span> <span class="fu"><a href="../reference/mlxs_binomial.html">mlxs_binomial</a></span><span class="op">(</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            lambda <span class="op">=</span> <span class="va">lambda_enet</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            maxit <span class="op">=</span> <span class="fl">2000</span>, tol <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is</span></span>
<span><span class="co">#&gt; disabled.</span></span>
<span></span>
<span><span class="va">enet_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">enet_mark</span><span class="op">$</span><span class="va">expression</span><span class="op">)</span>,</span>
<span>  median_sec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">enet_mark</span><span class="op">$</span><span class="va">median</span>, units <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span>,</span>
<span>  mem_mb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">enet_mark</span><span class="op">$</span><span class="va">mem_alloc</span>, units <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span>,</span>
<span>  itr_per_sec <span class="op">=</span> <span class="va">enet_mark</span><span class="op">$</span><span class="va">`itr/sec`</span></span>
<span><span class="op">)</span></span>
<span><span class="va">enet_summary</span><span class="op">$</span><span class="va">relative</span> <span class="op">&lt;-</span> <span class="va">enet_summary</span><span class="op">$</span><span class="va">median_sec</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">enet_summary</span><span class="op">$</span><span class="va">median_sec</span><span class="op">)</span></span>
<span><span class="va">enet_summary</span></span>
<span><span class="co">#&gt;        method median_sec   mem_mb itr_per_sec relative</span></span>
<span><span class="co">#&gt; 1      glmnet 0.03409093 22547280  23.8013044  1.00000</span></span>
<span><span class="co">#&gt; 2 mlxs_glmnet 1.34677665 45710824   0.7379547 39.50543</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">enet_mark</span>, type <span class="op">=</span> <span class="st">"beeswarm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="benchmark-lm-mlxs_files/figure-html/glmnet-flights-benchmark-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">enet_ref</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></span><span class="op">(</span><span class="va">x_enet</span>, <span class="va">y_enet</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                           lambda <span class="op">=</span> <span class="va">lambda_enet</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           thresh <span class="op">=</span> <span class="fl">1e-6</span>, maxit <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span></span>
<span><span class="va">enet_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlxs_glmnet.html">mlxs_glmnet</a></span><span class="op">(</span><span class="va">x_enet</span>, <span class="va">y_enet</span>, family <span class="op">=</span> <span class="fu"><a href="../reference/mlxs_binomial.html">mlxs_binomial</a></span><span class="op">(</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        lambda <span class="op">=</span> <span class="va">lambda_enet</span>, standardize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        maxit <span class="op">=</span> <span class="fl">2000</span>, tol <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  coefficients_max_difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">enet_ref</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span> <span class="op">-</span> <span class="va">enet_fit</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  intercept_difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">enet_ref</span><span class="op">$</span><span class="va">a0</span><span class="op">)</span> <span class="op">-</span> <span class="va">enet_fit</span><span class="op">$</span><span class="va">a0</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; coefficients_max_difference        intercept_difference </span></span>
<span><span class="co">#&gt;                0.5963112556                0.0005400035</span></span></code></pre></div>
<p>Even with a rich feature expansion, the MLX implementation matches
<code>glmnet</code> within modest tolerances while keeping all updates
on the GPU.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Hugh-Jones.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
